CREATE OR REPLACE FUNCTION load_csv_file(
    target_table text,
    csv_path text,
    col_count integer)
  RETURNS void AS
$BODY$

declare

iter integer; -- dummy integer to iterate columns with
col text; -- variable to keep the column name at each iteration
col_first text; -- first column name, e.g., top left corner on a csv file or spreadsheet

	begin
    
    create table conceptnettable ();

    -- add just enough number of columns
    for iter in 1..col_count
    loop
        execute format('alter table conceptnettable add column col_%s text;', iter);
    end loop;

    -- copy the data from csv file
    execute format('copy conceptnettable from %L with delimiter '','' quote ''"'' csv ', csv_path);

    iter := 1;
    col_first := (select col_1 from conceptnettable limit 1);

    -- update the column names based on the first row which has the column names
    for col in execute format('select unnest(string_to_array(trim(conceptnettable::text, ''()''), '','')) from conceptnettable where col_1 = %L', col_first)
    loop
        execute format('alter table conceptnettable rename column col_%s to %s', iter, col);
        iter := iter + 1;
    end loop;
end;
$BODY$ LANGUAGE plpgsql STRICT Volatile;

select load_csv_file('coneceptnetTable','F:\Master Course Materials\Second Semester\Recommender-app-flask-python\flaskPython\conceptnet-assertions-5.6.0.csv',7);